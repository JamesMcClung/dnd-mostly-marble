let cached_popups=new Map;function getPopup(o){if(!cached_popups.has(o)){var t=window.POPUP_DATA[o],n=t.associated_url?`<div class="popupHeaderButton popupHeaderButtonHref"><a href="${t.associated_url}">»</a></div>`:"",i=document.createElement("template");i.innerHTML=`<div class="popup" data-injection-arg="${o}">
                <div class="popupHeader">
                    <div class="popupHeaderButtongroup" onmousedown="event.stopPropagation()">
                        ${n}
                        <div class="popupHeaderButton popupHeaderButtonSticky">○</div>
                        <div class="popupHeaderButton popupHeaderButtonClose">×</div>
                    </div>
                    ${t.title}
                </div>
                <div class="popupContent">
                    ${t.content_html}
                </div>
            </div>`;let e=i.content.firstChild;if(null===e)throw Error("template didn't work: "+i);if(!(e instanceof HTMLElement))throw Error("popup isn't an HTMLElement: "+e);e.onclick=t=>sendToTop(e),setPositionToAbsolute(e,!1),e.getElementsByClassName("popupHeaderButtonSticky")[0].addEventListener("click",t=>toggleIsPinned(o,t)),e.getElementsByClassName("popupHeaderButtonClose")[0].onclick=t=>closePopup(e),getPopupContent(e).firstElementChild.onscroll=t=>{getIsPinned(e)&&mutatePinnedPopupDatum(getInjectionArg(e),t=>t.scroll=getPopupScroll(e))},document.getElementsByTagName("article")[0].append(e),cached_popups.set(o,e)}return cached_popups.get(o)}function getPopupHeader(t){return t.children[0]}function getPopupContent(t){return t.children[1]}function getPopupScroll(t){return getPopupContent(t).firstElementChild.scrollTop}function setPopupScroll(t,e){getPopupContent(t).firstElementChild.scrollTop=e}function getInjectionArg(t){return t.dataset.injectionArg}function getPageHeader(){return document.getElementsByTagName("header")[0]}function getClientRect(t){t=t.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left}}function getPageRect(t){t=t.getBoundingClientRect();return{top:t.top+window.scrollY,right:t.right+window.scrollX,bottom:t.bottom+window.scrollY,left:t.left+window.scrollX}}function setCoords(e,t){e.style.top=t.top+"px",void 0!==t.left?(e.style.left=t.left+"px",e.style.removeProperty("right")):(e.style.right=t.right+"px",e.style.removeProperty("left")),getIsPinned(e)&&mutatePinnedPopupDatum(getInjectionArg(e),t=>{t.left=e.style.left,t.right=e.style.right,t.top=e.style.top});var o,t=document.getElementsByTagName("body")[0],n=getClientRect(e).bottom-getClientRect(t).bottom;0<n&&(o=Number(t.style.paddingBottom.slice(0,-2)),t.style.paddingBottom=o+n+"px")}let PINNED_POPUP_DATA_KEY="pinnedPopupParams";if(null===sessionStorage.getItem(PINNED_POPUP_DATA_KEY))sessionStorage.setItem(PINNED_POPUP_DATA_KEY,JSON.stringify([]));else{let t=JSON.parse(sessionStorage.getItem(PINNED_POPUP_DATA_KEY));for(let e of t){let t=getPopup(e.injection_arg);setIsDraggable(t,!0),setPositionToFixed(t,!1),setIsVisible(t,!0),t.style.top=e.top,t.style.right=e.right,t.style.left=e.left,setPopupScroll(t,e.scroll),e.isCollapsed&&t.classList.add("isCollapsed")}}function getIsPinned(t){return"fixed"===t.style.position}function setIsPinned(e,t){let o=getInjectionArg(e);t?(setPositionToFixed(e),mutatePinnedPopupData(t=>t.push({injection_arg:o,left:e.style.left,right:e.style.right,top:e.style.top,isCollapsed:e.classList.contains("isCollapsed"),scroll:getPopupScroll(e)}))):(setPositionToAbsolute(e),mutatePinnedPopupData(e=>{for(let t=0;t<e.length;t++)if(e[t].injection_arg===o){e.splice(t,1);break}}))}function toggleIsPinned(t,e){e.stopPropagation();e=getPopup(t);setIsPinned(e,!getIsPinned(e))}function mutatePinnedPopupData(t){var e=JSON.parse(sessionStorage.getItem(PINNED_POPUP_DATA_KEY));t(e),sessionStorage.setItem(PINNED_POPUP_DATA_KEY,JSON.stringify(e))}function mutatePinnedPopupDatum(o,n){mutatePinnedPopupData(t=>{for(var e of t)if(e.injection_arg===o){n(e);break}})}function setPositionToAbsolute(t,e=!0){var o=getPageRect(t);t.style.position="absolute",t.querySelector(".popupHeaderButtonSticky").innerHTML="&#9675;",e&&(t.style.right?setCoords(t,{top:o.top,right:getClientRect(document.documentElement).right-o.right,left:void 0}):setCoords(t,{top:o.top,left:o.left,right:void 0}))}function setPositionToFixed(t,e=!0){var o=getClientRect(t);t.style.position="fixed",t.querySelector(".popupHeaderButtonSticky").innerHTML="&#9679;",e&&(t.style.right?setCoords(t,{top:o.top,right:getClientRect(document.documentElement).right-o.right,left:void 0}):setCoords(t,{top:o.top,left:o.left,right:void 0}))}let highest_z_index=1;function sendToTop(t){if(highest_z_index+=1,t.style.zIndex=String(highest_z_index),getPageHeader().style.zIndex=String(highest_z_index+1),getIsPinned(t)){let o=getInjectionArg(t);mutatePinnedPopupData(e=>{for(let t=0;t<e.length;t++)if(e[t].injection_arg===o){e.push(...e.splice(t,1));break}})}}function getAdjustedY(t,e){return t<e?e:t}function getIsCollapsed(t){return t.classList.contains("isCollapsed")}function setIsCollapsed(t,e){e?t.classList.add("isCollapsed"):t.classList.remove("isCollapsed"),getIsPinned(t)&&mutatePinnedPopupDatum(getInjectionArg(t),t=>t.isCollapsed=e)}function sendToAnchor(t,e){var o=getPageRect(e);if(!e.classList.contains("popupAnchor"))throw Error("Element isn't a popup anchor: "+e.getHTML());var n=t.getBoundingClientRect().height,i=window.innerHeight,s=o.top-n,l=getMinPopupClientY();getClientRect(e).bottom+n>i&&l<s?setCoords(t,{left:o.left,top:s,right:void 0}):setCoords(t,{left:o.left,top:o.bottom,right:void 0})}function getIsDraggable(t){return t.classList.contains("isDraggable")}function setIsDraggable(d,t){var e=getPopupHeader(d);if(t){let i,s,l,p=-1,r=-1,a=!1;sendToTop(d),e.onmousedown=t=>{i=getMinPopupClientY()+t.clientY-getClientRect(d).top,s=t.clientX,l=getAdjustedY(t.clientY,i),document.onmousemove=t=>{var e=t.clientX-s,o=getAdjustedY(t.clientY,i)-l,t=(s=t.clientX,l=getAdjustedY(t.clientY,i),getClientRect(d)),n=d.offsetTop+o;t.left+e<=0||0<r&&p+e<r?(p<0&&(p=r=t.right),p+=e,t=getClientRect(document.documentElement).right-p,setCoords(d,{top:n,right:t,left:void 0})):(t=d.offsetLeft+e,setCoords(d,{top:n,left:t,right:void 0}),p=r=-1),a=a||0!=e||0!=o},document.onmouseup=t=>{document.onmouseup=null,document.onmousemove=null,a||setIsCollapsed(d,!getIsCollapsed(d)),a=!1},sendToTop(d)},d.classList.add("isDraggable")}else e.onmousedown=null,d.classList.remove("isDraggable"),setIsCollapsed(d,!1)}function getMinPopupClientY(){return getPageHeader().getBoundingClientRect().bottom}function handleAnchorClick(t,e,o){o.stopPropagation();o=getPopup(t);getIsDraggable(o)?closePopup(o):(setIsDraggable(o,!0),sendToAnchor(o,e))}function showPopup(t,e,o){o.stopPropagation();o=getPopup(t);sendToTop(o),setIsVisible(o,!0),getIsDraggable(o)||sendToAnchor(o,e)}function hidePopup(t,e){e.stopPropagation(),setIsVisible(getPopup(t),!1)}function setIsVisible(t,e){e?t.classList.add("visible"):t.classList.remove("visible")}function closePopup(t){setPopupScroll(t,0),setIsVisible(t,!1),setIsPinned(t,!1),setIsCollapsed(t,!1),setIsDraggable(t,!1)}