let cached_popups=new Map;function getPopup(o){if(!cached_popups.has(o)){var e=window.POPUP_DATA[o],n=e.associated_url?`<div class="popupHeaderButton popupHeaderButtonHref"><a href="${e.associated_url}">»</a></div>`:"",s=document.createElement("template");s.innerHTML=`<div class="popup" style="left: 649px; top: 165px;">
                    <div class="popupHeader">
                        <div class="popupHeaderButtongroup" onmousedown="event.stopPropagation()">
                            ${n}
                            <div class="popupHeaderButton popupHeaderButtonSticky">○</div>
                            <div class="popupHeaderButton popupHeaderButtonClose">×</div>
                        </div>
                        ${e.title}
                    </div>
                    <div class="popupContent">
                        ${e.content_html}
                    </div>
                </div>`;let t=s.content.firstChild;if(null===t)throw Error("template didn't work: "+s);if(!(t instanceof HTMLElement))throw Error("popup isn't an HTMLElement: "+t);t.getElementsByClassName("popupHeaderButtonSticky")[0].addEventListener("click",e=>toggleFixedPosition(t,{event:e})),t.getElementsByClassName("popupHeaderButtonClose")[0].addEventListener("click",e=>toggleDragEnabled(o,{event:e})),cached_popups.set(o,t)}return cached_popups.get(o)}function getClientCoords(e){return e.getBoundingClientRect()}function getPageCoords(e){e=e.getBoundingClientRect();return{top:e.top+window.scrollY,right:e.right+window.scrollX,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX}}function setElementTopLeft(e,t){e.style.left=t.left+"px",e.style.top=t.top+"px"}function toggleFixedPosition(e,t={}){t.event&&t.event.stopPropagation(),t.setAbsolute||"fixed"==e.style.position?!t.setAbsolute&&"absolute"==e.style.position||(t=getPageCoords(e),e.style.position="absolute",setElementTopLeft(e,t),e.querySelector(".popupHeader").querySelector(".popupHeaderButtongroup").querySelector(".popupHeaderButtonSticky").innerHTML="&#9675;"):(t=getClientCoords(e),e.style.position="fixed",setElementTopLeft(e,t),e.querySelector(".popupHeader").querySelector(".popupHeaderButtongroup").querySelector(".popupHeaderButtonSticky").innerHTML="&#9679;")}function sendToTop(e){var t,o,n=document.getElementsByTagName("article")[0];n.lastChild!==e&&(o=(t=e.querySelector(".popupContent")).firstElementChild.scrollTop,n.append(e),t.firstElementChild.scrollTop=o)}function getAdjustedY(e,t){return e<t?t:e}function toggleDragEnabled(e,t={}){let n=getPopup(e);t.event&&t.event.stopPropagation();let s,l,p,i=-1,r=-1,d=!1,o=n.querySelector(".popupHeader");function u(e){var t=e.clientX-l,o=getAdjustedY(e.clientY,s)-p,e=(l=e.clientX,p=getAdjustedY(e.clientY,s),getClientCoords(n));n.style.top=n.offsetTop+o+"px",e.left+t<=0||0<r&&i+t<r?(i<0&&(i=r=e.right),i+=t,n.style.right=window.innerWidth-i+"px",n.style.removeProperty("left")):(n.style.left=n.offsetLeft+t+"px",n.style.removeProperty("right"),i=r=-1),d=d||0!=t||0!=o}function a(){o.onmouseup=null,document.onmouseup=null,document.onmousemove=null,d||(n.classList.contains("isCollapsed")?n.classList.remove("isCollapsed"):n.classList.add("isCollapsed")),d=!1}n.onclick=e=>{sendToTop(n),e.stopPropagation()},o.onmousedown?(o.onmousedown=null,toggleFixedPosition(n,{setAbsolute:!0}),n.classList.remove("dragEnabled"),n.classList.remove("isCollapsed"),e=getPageCoords(t.event.target),setElementTopLeft(n,{left:e.left,top:e.bottom}),n.style.removeProperty("right")):(setElementTopLeft(n,getPageCoords(n)),sendToTop(n),o.onmousedown=function(e){s=document.getElementsByTagName("header")[0].getBoundingClientRect().bottom+e.clientY-getClientCoords(n).top,l=e.clientX,p=getAdjustedY(e.clientY,s),o.onmouseup=a,document.onmouseup=a,document.onmousemove=u,sendToTop(n)},n.classList.add("dragEnabled"))}function showPopup(e,t){var e=getPopup(e);sendToTop(e),e.classList.add("visible"),e.classList.contains("dragEnabled")||setElementTopLeft(e,{left:(e=getPageCoords(t)).left,top:e.bottom})}function hidePopup(e){getPopup(e).classList.remove("visible")}