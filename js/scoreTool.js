let ABILITIES=["Strength","Dexterity","Constitution","Intelligence","Wisdom","Charisma"],LEVEL="Level",MAX_POINTS=18,BUYABLE_SCORES=[-1,0,1,2,3],BUYABLE_SCORE_COSTS=[0,1,2,4,6],ASI_LEVELS=[4,8,12,16,19],ASI_SCORE_LIMITS=[5,5,5,5,6],MIN_SCORE=Math.min(...BUYABLE_SCORES),MAX_BUYABLE_SCORE=Math.max(...BUYABLE_SCORES),MAX_SCORE=Math.max(MAX_BUYABLE_SCORE,...ASI_SCORE_LIMITS);function getSlider(e){return document.getElementById(e+"_slider")}function getValue(e){return Number(e.value)}function getValueDisplay(e){return document.getElementById(e+"_value")}function getNameDisplay(e){return document.getElementById(e+"_label")}updateScores(getSlider("Level"),!1);for(let e of ABILITIES)updateScores(getSlider(e),e===ABILITIES[ABILITIES.length-1]);function updateScores(e,t=!0){let n=e.id.split("_")[0];var i;if(n===LEVEL&&(i=e.value,getValueDisplay(n).textContent=i,document.getElementById("score_tool_asis_max").textContent=String(getMaxNAsis(Number(i)))),t&&updateDisplayAndMaxs(),n!==LEVEL)getValueDisplay(n).textContent=formatScore(e.value);else for(let e of ABILITIES)updateScores(getSlider(e),e==ABILITIES[ABILITIES.length-1])}function formatScore(e){e=Number(e);return e<=0?""+e:"+"+e}function getMaxNAsis(t){for(let e=ASI_LEVELS.length;0<e;e--)if(t>=ASI_LEVELS[e-1])return e;return 0}function getAvailableAsiIdxs(e){return ASI_LEVELS.map((e,t)=>t).slice(0,getMaxNAsis(e))}function getScore(e){return BUYABLE_SCORES[BUYABLE_SCORE_COSTS.indexOf(e.n_points)]+e.asi_idxs.length}function getOptimalScorePayments(e,n){let i=n.map(e=>({asi_idxs:[],n_points:0}));var r,a=i.map((e,t)=>t).filter(e=>getScore(i[e])<n[e]);if(0===a.length)return i;let t=MAX_POINTS;e:for(var o of BUYABLE_SCORE_COSTS){for(var l of a.slice()){var S=i[l],s=o-S.n_points;if(t<s)break e;t-=s,S.n_points=o,getScore(S)===n[l]&&removeElement(a,l)}if(0===a.length)return i}for(r of getAvailableAsiIdxs(e)){let e,t=Number.POSITIVE_INFINITY;for(var u of a.slice()){var E=getScore(i[u]);E>=ASI_SCORE_LIMITS[r]||E>t||(t=E,e=u)}if(void 0!==e&&(i[e].asi_idxs.push(r),getScore(i[e])===n[e]&&removeElement(a,e),0===a.length))return i}}function getMaxScores(t,n){var e=getMaxNAsis(t),i=0===e?BUYABLE_SCORES[BUYABLE_SCORES.length-1]:ASI_SCORE_LIMITS[e-1],r=BUYABLE_SCORES[0],a=[],o=n.map(getScore);for(let e=0;e<n.length;e++){var l=o[e];for(o[e]=i;o[e]>=r;o[e]--){if(o[e]===l){a.push(o[e]);break}if(void 0!==getOptimalScorePayments(t,o)){a.push(o[e]);break}}o[e]=l}return a}function decrementHighestScore(t){let n=Number.NEGATIVE_INFINITY,i=[];for(let e=0;e<t.length;e++)t[e]>n?(n=t[e],i=[e]):t[e]==n&&i.push(e);--t[i[Math.floor(Math.random()*i.length)]]}function updateDisplayAndMaxs(){var e=getValue(getSlider("Level")),t=ABILITIES.map(e=>getValue(getSlider(e)));let n=getOptimalScorePayments(e,t);for(;void 0===n;)decrementHighestScore(t),n=getOptimalScorePayments(e,t);var i=getMaxScores(e,n);setDisplayAndMaxs(n,i,e)}function setDisplayAndMaxs(t,n,e){setRemainingDisplay(MAX_POINTS-sum(t.map(e=>e.n_points)),getMaxNAsis(e)-sum(t.map(e=>e.asi_idxs.length)));for(let e=0;e<ABILITIES.length;e++){var i=ABILITIES[e];setPaymentDisplay(i,t[e].n_points,t[e].asi_idxs.length),setSliderMaxScore(i,n[e])}}function setRemainingDisplay(e,t){document.getElementById("score_tool_points").textContent=String(e),document.getElementById("score_tool_asis").textContent=String(t)}function setPaymentDisplay(e,t,n){document.getElementById(e+"_points").textContent=String(t),document.getElementById(e+"_asi").textContent=String(n)}function setSliderMaxScore(e,t){var n=getSlider(e),i=(n.max=String(t),n.parentElement.clientWidth),t=(i-20)*(t-MIN_SCORE)/(MAX_SCORE-MIN_SCORE)+20,t=(n.style.width=100*t/i+"%",n.value===n.max?"bolder":"normal");getValueDisplay(e).style.fontWeight=t,getNameDisplay(e).style.fontWeight=t}function sum(e){return e.reduce((e,t)=>e+t,0)}function removeElement(e,t){e.splice(e.indexOf(t),1)}